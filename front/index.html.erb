<html>
  <head>
    <style>
      html{
        background-color: white;
      }
      #main {
        padding: 115px 0 0 235px;
      }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script>
      var timerStop = false;
      
      $(document).ready(function(){
        window.setTimeout(function(){countdown()}, 1000);
      });

      function handle_ajax_response(response, success, error){
        if (typeof response.error == "undefined"){
          success();
        } else {
          error();
        }
      }

      function say(word, scale_x){
        scale_x = typeof scale_x !== 'undefined' ? scale_x : 1;
        jQuery.ajax({
          type: "POST",
          url: "/say",
          data: {"word": word, "scale_x": scale_x},
          success: function(response){
            handle_ajax_response(response,
            function(){
              $('#main').html(response);
            },
            function(){})}
        });
      }

      function party(){
        jQuery.ajax({
          type: "POST",
          url: "/party",
          data: {},
          success: function(response){
            handle_ajax_response(response,
            function(){
              $('#main').html(response);
            },
            function(){})
          }
        });
        return false;
      }

      function countdown() {
        if (timerStop == false) {
          var timestamp = $('#timestamp').val();
          if (timestamp-1 == 0) {
             timerStop = true;
             say('Party!',"1.5");
             $('html').css('background-color', 'black');
             window.setInterval(party, 200);
          } else {
            say(timestamp-1);
            $('#timestamp').val(timestamp-1);
            window.setTimeout(function(){countdown()}, 1000);
          }
        }
      }
    </script>
  </head>
  <body>
    <input id="timestamp" type="hidden" value="10">
    <section id='main'>
      <%= bird.to_svg %>
    </section>
  </body>
</html>